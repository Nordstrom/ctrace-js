'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var cov_1j9cw8jn14 = function () {
  var path = '/Users/asaj/source/cma/ctrace-js/src/propagators/textPropagator.js',
      hash = '9e67c5ceef2b232a2517148977acd0cefdfd42d3',
      global = new Function('return this')(),
      gcv = '__coverage__',
      coverageData = {
    path: '/Users/asaj/source/cma/ctrace-js/src/propagators/textPropagator.js',
    statementMap: {
      '0': {
        start: {
          line: 4,
          column: 4
        },
        end: {
          line: 4,
          column: 24
        }
      },
      '1': {
        start: {
          line: 4,
          column: 15
        },
        end: {
          line: 4,
          column: 24
        }
      },
      '2': {
        start: {
          line: 5,
          column: 4
        },
        end: {
          line: 5,
          column: 54
        }
      },
      '3': {
        start: {
          line: 6,
          column: 4
        },
        end: {
          line: 6,
          column: 51
        }
      },
      '4': {
        start: {
          line: 7,
          column: 4
        },
        end: {
          line: 7,
          column: 56
        }
      },
      '5': {
        start: {
          line: 8,
          column: 4
        },
        end: {
          line: 8,
          column: 52
        }
      },
      '6': {
        start: {
          line: 9,
          column: 4
        },
        end: {
          line: 9,
          column: 52
        }
      },
      '7': {
        start: {
          line: 13,
          column: 14
        },
        end: {
          line: 16,
          column: 5
        }
      },
      '8': {
        start: {
          line: 20,
          column: 4
        },
        end: {
          line: 26,
          column: 5
        }
      },
      '9': {
        start: {
          line: 21,
          column: 6
        },
        end: {
          line: 21,
          column: 48
        }
      },
      '10': {
        start: {
          line: 21,
          column: 40
        },
        end: {
          line: 21,
          column: 48
        }
      },
      '11': {
        start: {
          line: 22,
          column: 6
        },
        end: {
          line: 22,
          column: 55
        }
      },
      '12': {
        start: {
          line: 22,
          column: 47
        },
        end: {
          line: 22,
          column: 55
        }
      },
      '13': {
        start: {
          line: 23,
          column: 6
        },
        end: {
          line: 23,
          column: 32
        }
      },
      '14': {
        start: {
          line: 23,
          column: 20
        },
        end: {
          line: 23,
          column: 32
        }
      },
      '15': {
        start: {
          line: 24,
          column: 6
        },
        end: {
          line: 24,
          column: 24
        }
      },
      '16': {
        start: {
          line: 24,
          column: 16
        },
        end: {
          line: 24,
          column: 24
        }
      },
      '17': {
        start: {
          line: 25,
          column: 6
        },
        end: {
          line: 25,
          column: 88
        }
      },
      '18': {
        start: {
          line: 27,
          column: 4
        },
        end: {
          line: 27,
          column: 38
        }
      },
      '19': {
        start: {
          line: 27,
          column: 17
        },
        end: {
          line: 27,
          column: 38
        }
      },
      '20': {
        start: {
          line: 28,
          column: 4
        },
        end: {
          line: 28,
          column: 45
        }
      },
      '21': {
        start: {
          line: 28,
          column: 35
        },
        end: {
          line: 28,
          column: 45
        }
      },
      '22': {
        start: {
          line: 32,
          column: 4
        },
        end: {
          line: 32,
          column: 75
        }
      },
      '23': {
        start: {
          line: 32,
          column: 29
        },
        end: {
          line: 32,
          column: 75
        }
      },
      '24': {
        start: {
          line: 33,
          column: 4
        },
        end: {
          line: 33,
          column: 72
        }
      },
      '25': {
        start: {
          line: 33,
          column: 28
        },
        end: {
          line: 33,
          column: 72
        }
      },
      '26': {
        start: {
          line: 35,
          column: 20
        },
        end: {
          line: 35,
          column: 39
        }
      },
      '27': {
        start: {
          line: 36,
          column: 4
        },
        end: {
          line: 36,
          column: 24
        }
      },
      '28': {
        start: {
          line: 36,
          column: 18
        },
        end: {
          line: 36,
          column: 24
        }
      },
      '29': {
        start: {
          line: 37,
          column: 4
        },
        end: {
          line: 40,
          column: 5
        }
      },
      '30': {
        start: {
          line: 38,
          column: 6
        },
        end: {
          line: 38,
          column: 48
        }
      },
      '31': {
        start: {
          line: 38,
          column: 40
        },
        end: {
          line: 38,
          column: 48
        }
      },
      '32': {
        start: {
          line: 39,
          column: 6
        },
        end: {
          line: 39,
          column: 77
        }
      }
    },
    fnMap: {
      '0': {
        name: '(anonymous_0)',
        decl: {
          start: {
            line: 3,
            column: 2
          },
          end: {
            line: 3,
            column: 3
          }
        },
        loc: {
          start: {
            line: 3,
            column: 21
          },
          end: {
            line: 10,
            column: 3
          }
        },
        line: 3
      },
      '1': {
        name: '(anonymous_1)',
        decl: {
          start: {
            line: 12,
            column: 2
          },
          end: {
            line: 12,
            column: 3
          }
        },
        loc: {
          start: {
            line: 12,
            column: 20
          },
          end: {
            line: 29,
            column: 3
          }
        },
        line: 12
      },
      '2': {
        name: '(anonymous_2)',
        decl: {
          start: {
            line: 31,
            column: 2
          },
          end: {
            line: 31,
            column: 3
          }
        },
        loc: {
          start: {
            line: 31,
            column: 32
          },
          end: {
            line: 41,
            column: 3
          }
        },
        line: 31
      }
    },
    branchMap: {
      '0': {
        loc: {
          start: {
            line: 4,
            column: 4
          },
          end: {
            line: 4,
            column: 24
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 4,
            column: 4
          },
          end: {
            line: 4,
            column: 24
          }
        }, {
          start: {
            line: 4,
            column: 4
          },
          end: {
            line: 4,
            column: 24
          }
        }],
        line: 4
      },
      '1': {
        loc: {
          start: {
            line: 5,
            column: 22
          },
          end: {
            line: 5,
            column: 54
          }
        },
        type: 'binary-expr',
        locations: [{
          start: {
            line: 5,
            column: 22
          },
          end: {
            line: 5,
            column: 37
          }
        }, {
          start: {
            line: 5,
            column: 41
          },
          end: {
            line: 5,
            column: 54
          }
        }],
        line: 5
      },
      '2': {
        loc: {
          start: {
            line: 6,
            column: 21
          },
          end: {
            line: 6,
            column: 51
          }
        },
        type: 'binary-expr',
        locations: [{
          start: {
            line: 6,
            column: 21
          },
          end: {
            line: 6,
            column: 35
          }
        }, {
          start: {
            line: 6,
            column: 39
          },
          end: {
            line: 6,
            column: 51
          }
        }],
        line: 6
      },
      '3': {
        loc: {
          start: {
            line: 7,
            column: 25
          },
          end: {
            line: 7,
            column: 56
          }
        },
        type: 'binary-expr',
        locations: [{
          start: {
            line: 7,
            column: 25
          },
          end: {
            line: 7,
            column: 43
          }
        }, {
          start: {
            line: 7,
            column: 47
          },
          end: {
            line: 7,
            column: 56
          }
        }],
        line: 7
      },
      '4': {
        loc: {
          start: {
            line: 8,
            column: 23
          },
          end: {
            line: 8,
            column: 52
          }
        },
        type: 'binary-expr',
        locations: [{
          start: {
            line: 8,
            column: 23
          },
          end: {
            line: 8,
            column: 39
          }
        }, {
          start: {
            line: 8,
            column: 43
          },
          end: {
            line: 8,
            column: 52
          }
        }],
        line: 8
      },
      '5': {
        loc: {
          start: {
            line: 9,
            column: 23
          },
          end: {
            line: 9,
            column: 52
          }
        },
        type: 'binary-expr',
        locations: [{
          start: {
            line: 9,
            column: 23
          },
          end: {
            line: 9,
            column: 39
          }
        }, {
          start: {
            line: 9,
            column: 43
          },
          end: {
            line: 9,
            column: 52
          }
        }],
        line: 9
      },
      '6': {
        loc: {
          start: {
            line: 21,
            column: 6
          },
          end: {
            line: 21,
            column: 48
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 21,
            column: 6
          },
          end: {
            line: 21,
            column: 48
          }
        }, {
          start: {
            line: 21,
            column: 6
          },
          end: {
            line: 21,
            column: 48
          }
        }],
        line: 21
      },
      '7': {
        loc: {
          start: {
            line: 22,
            column: 6
          },
          end: {
            line: 22,
            column: 55
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 22,
            column: 6
          },
          end: {
            line: 22,
            column: 55
          }
        }, {
          start: {
            line: 22,
            column: 6
          },
          end: {
            line: 22,
            column: 55
          }
        }],
        line: 22
      },
      '8': {
        loc: {
          start: {
            line: 23,
            column: 6
          },
          end: {
            line: 23,
            column: 32
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 23,
            column: 6
          },
          end: {
            line: 23,
            column: 32
          }
        }, {
          start: {
            line: 23,
            column: 6
          },
          end: {
            line: 23,
            column: 32
          }
        }],
        line: 23
      },
      '9': {
        loc: {
          start: {
            line: 24,
            column: 6
          },
          end: {
            line: 24,
            column: 24
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 24,
            column: 6
          },
          end: {
            line: 24,
            column: 24
          }
        }, {
          start: {
            line: 24,
            column: 6
          },
          end: {
            line: 24,
            column: 24
          }
        }],
        line: 24
      },
      '10': {
        loc: {
          start: {
            line: 27,
            column: 4
          },
          end: {
            line: 27,
            column: 38
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 27,
            column: 4
          },
          end: {
            line: 27,
            column: 38
          }
        }, {
          start: {
            line: 27,
            column: 4
          },
          end: {
            line: 27,
            column: 38
          }
        }],
        line: 27
      },
      '11': {
        loc: {
          start: {
            line: 28,
            column: 4
          },
          end: {
            line: 28,
            column: 45
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 28,
            column: 4
          },
          end: {
            line: 28,
            column: 45
          }
        }, {
          start: {
            line: 28,
            column: 4
          },
          end: {
            line: 28,
            column: 45
          }
        }],
        line: 28
      },
      '12': {
        loc: {
          start: {
            line: 28,
            column: 8
          },
          end: {
            line: 28,
            column: 33
          }
        },
        type: 'binary-expr',
        locations: [{
          start: {
            line: 28,
            column: 8
          },
          end: {
            line: 28,
            column: 19
          }
        }, {
          start: {
            line: 28,
            column: 23
          },
          end: {
            line: 28,
            column: 33
          }
        }],
        line: 28
      },
      '13': {
        loc: {
          start: {
            line: 32,
            column: 4
          },
          end: {
            line: 32,
            column: 75
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 32,
            column: 4
          },
          end: {
            line: 32,
            column: 75
          }
        }, {
          start: {
            line: 32,
            column: 4
          },
          end: {
            line: 32,
            column: 75
          }
        }],
        line: 32
      },
      '14': {
        loc: {
          start: {
            line: 33,
            column: 4
          },
          end: {
            line: 33,
            column: 72
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 33,
            column: 4
          },
          end: {
            line: 33,
            column: 72
          }
        }, {
          start: {
            line: 33,
            column: 4
          },
          end: {
            line: 33,
            column: 72
          }
        }],
        line: 33
      },
      '15': {
        loc: {
          start: {
            line: 36,
            column: 4
          },
          end: {
            line: 36,
            column: 24
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 36,
            column: 4
          },
          end: {
            line: 36,
            column: 24
          }
        }, {
          start: {
            line: 36,
            column: 4
          },
          end: {
            line: 36,
            column: 24
          }
        }],
        line: 36
      },
      '16': {
        loc: {
          start: {
            line: 38,
            column: 6
          },
          end: {
            line: 38,
            column: 48
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 38,
            column: 6
          },
          end: {
            line: 38,
            column: 48
          }
        }, {
          start: {
            line: 38,
            column: 6
          },
          end: {
            line: 38,
            column: 48
          }
        }],
        line: 38
      }
    },
    s: {
      '0': 0,
      '1': 0,
      '2': 0,
      '3': 0,
      '4': 0,
      '5': 0,
      '6': 0,
      '7': 0,
      '8': 0,
      '9': 0,
      '10': 0,
      '11': 0,
      '12': 0,
      '13': 0,
      '14': 0,
      '15': 0,
      '16': 0,
      '17': 0,
      '18': 0,
      '19': 0,
      '20': 0,
      '21': 0,
      '22': 0,
      '23': 0,
      '24': 0,
      '25': 0,
      '26': 0,
      '27': 0,
      '28': 0,
      '29': 0,
      '30': 0,
      '31': 0,
      '32': 0
    },
    f: {
      '0': 0,
      '1': 0,
      '2': 0
    },
    b: {
      '0': [0, 0],
      '1': [0, 0],
      '2': [0, 0],
      '3': [0, 0],
      '4': [0, 0],
      '5': [0, 0],
      '6': [0, 0],
      '7': [0, 0],
      '8': [0, 0],
      '9': [0, 0],
      '10': [0, 0],
      '11': [0, 0],
      '12': [0, 0],
      '13': [0, 0],
      '14': [0, 0],
      '15': [0, 0],
      '16': [0, 0]
    },
    _coverageSchema: '332fd63041d2c1bcb487cc26dd0d5f7d97098a6c'
  },
      coverage = global[gcv] || (global[gcv] = {});

  if (coverage[path] && coverage[path].hash === hash) {
    return coverage[path];
  }

  coverageData.hash = hash;
  return coverage[path] = coverageData;
}();

class TextPropagator {

  constructor(opts) {
    ++cov_1j9cw8jn14.f[0];
    ++cov_1j9cw8jn14.s[0];

    if (!opts) {
        ++cov_1j9cw8jn14.b[0][0];
        ++cov_1j9cw8jn14.s[1];
        opts = {};
      } else {
      ++cov_1j9cw8jn14.b[0][1];
    }++cov_1j9cw8jn14.s[2];
    this.traceIdKey = (++cov_1j9cw8jn14.b[1][0], opts.traceIdKey) || (++cov_1j9cw8jn14.b[1][1], 'ct-trace-id');
    ++cov_1j9cw8jn14.s[3];
    this.spanIdKey = (++cov_1j9cw8jn14.b[2][0], opts.spanIdKey) || (++cov_1j9cw8jn14.b[2][1], 'ct-span-id');
    ++cov_1j9cw8jn14.s[4];
    this.baggagePrefix = (++cov_1j9cw8jn14.b[3][0], opts.baggagePrefix) || (++cov_1j9cw8jn14.b[3][1], 'ct-bag-');
    ++cov_1j9cw8jn14.s[5];
    this.encodeValue = (++cov_1j9cw8jn14.b[4][0], opts.encodeValue) || (++cov_1j9cw8jn14.b[4][1], encodeURI);
    ++cov_1j9cw8jn14.s[6];
    this.decodeValue = (++cov_1j9cw8jn14.b[5][0], opts.decodeValue) || (++cov_1j9cw8jn14.b[5][1], decodeURI);
  }

  extract(carrier) {
    ++cov_1j9cw8jn14.f[1];

    let ctx = (++cov_1j9cw8jn14.s[7], {
      traceId: carrier[this.traceIdKey],
      spanId: carrier[this.spanIdKey]
    });

    let baggage;

    ++cov_1j9cw8jn14.s[8];
    for (let key in carrier) {
      ++cov_1j9cw8jn14.s[9];

      if (!carrier.hasOwnProperty(key)) {
          ++cov_1j9cw8jn14.b[6][0];
          ++cov_1j9cw8jn14.s[10];
          continue;
        } else {
        ++cov_1j9cw8jn14.b[6][1];
      }++cov_1j9cw8jn14.s[11];
      if (!key.startsWith(this.baggagePrefix)) {
          ++cov_1j9cw8jn14.b[7][0];
          ++cov_1j9cw8jn14.s[12];
          continue;
        } else {
        ++cov_1j9cw8jn14.b[7][1];
      }++cov_1j9cw8jn14.s[13];
      if (!baggage) {
          ++cov_1j9cw8jn14.b[8][0];
          ++cov_1j9cw8jn14.s[14];
          baggage = {};
        } else {
        ++cov_1j9cw8jn14.b[8][1];
      }++cov_1j9cw8jn14.s[15];
      if (!key) {
          ++cov_1j9cw8jn14.b[9][0];
          ++cov_1j9cw8jn14.s[16];
          continue;
        } else {
        ++cov_1j9cw8jn14.b[9][1];
      }++cov_1j9cw8jn14.s[17];
      baggage[key.substring(this.baggagePrefix.length)] = this.decodeValue(carrier[key]);
    }
    ++cov_1j9cw8jn14.s[18];
    if (baggage) {
        ++cov_1j9cw8jn14.b[10][0];
        ++cov_1j9cw8jn14.s[19];
        ctx.baggage = baggage;
      } else {
      ++cov_1j9cw8jn14.b[10][1];
    }++cov_1j9cw8jn14.s[20];
    if ((++cov_1j9cw8jn14.b[12][0], ctx.traceId) && (++cov_1j9cw8jn14.b[12][1], ctx.spanId)) {
        ++cov_1j9cw8jn14.b[11][0];
        ++cov_1j9cw8jn14.s[21];
        return ctx;
      } else {
      ++cov_1j9cw8jn14.b[11][1];
    }
  }

  inject(spanContext, carrier) {
    ++cov_1j9cw8jn14.f[2];
    ++cov_1j9cw8jn14.s[22];

    if (spanContext.traceId) {
        ++cov_1j9cw8jn14.b[13][0];
        ++cov_1j9cw8jn14.s[23];
        carrier[this.traceIdKey] = spanContext.traceId;
      } else {
      ++cov_1j9cw8jn14.b[13][1];
    }++cov_1j9cw8jn14.s[24];
    if (spanContext.spanId) {
        ++cov_1j9cw8jn14.b[14][0];
        ++cov_1j9cw8jn14.s[25];
        carrier[this.spanIdKey] = spanContext.spanId;
      } else {
      ++cov_1j9cw8jn14.b[14][1];
    }const baggage = (++cov_1j9cw8jn14.s[26], spanContext.baggage);
    ++cov_1j9cw8jn14.s[27];
    if (!baggage) {
        ++cov_1j9cw8jn14.b[15][0];
        ++cov_1j9cw8jn14.s[28];
        return;
      } else {
      ++cov_1j9cw8jn14.b[15][1];
    }++cov_1j9cw8jn14.s[29];
    for (let key in baggage) {
      ++cov_1j9cw8jn14.s[30];

      if (!baggage.hasOwnProperty(key)) {
          ++cov_1j9cw8jn14.b[16][0];
          ++cov_1j9cw8jn14.s[31];
          continue;
        } else {
        ++cov_1j9cw8jn14.b[16][1];
      }++cov_1j9cw8jn14.s[32];
      carrier[`${this.baggagePrefix}${key}`] = this.encodeValue(baggage[key]);
    }
  }
}
exports.default = TextPropagator;
module.exports = exports['default'];